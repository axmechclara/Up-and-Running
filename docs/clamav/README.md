---
title: ClamAV Antivirus Server
meta:
  - name: description
    content: ClamAV is an open source antivirus engine for detecting trojans, viruses, malware & other malicious threats.
noGlobalSocialShare: true
tags: ["antivirus", "security", "intrusion-detection", "intrusion-prevention"]
---

# ClamAV Antivirus Server

<TagLinks />

ClamAV is an open source (GPL) anti-virus engine used in a variety of situations including email scanning, web scanning, and end point security. It provides a number of utilities including a flexible and scalable multi-threaded daemon, a command line scanner and an advanced tool for automatic database updates.

[ClamAV website](https://www.clamav.net/) [Source code](https://www.clamav.net/downloads)

Setup and configuration has been tested on following OS with version:

* Ubuntu- 18.04, 20.04, Windows Server 2019
* ClamAV 0.102.4

## Configuration files

## Prerequisites

* `net-tools` (optional)

## Installation <Badge text="Rev 1" type="default"/>

* Set up description

## ClamAV server

First download the ClamAV scanner and the ClamAV daemon.

```
server@ubuntu:~$ sudo apt-get install clamav clamav-daemon
```

Proceed to stop freshclam the automatic database update tool for ClamAV.

```
server@ubuntu:~$ sudo systemctl stop clamav-freshclam
```

Next run freshclam to update to the latest definition database.

```
server@ubuntu:~$ sudo freshclam
```

Once you've ran the freshclam command you can check the log `/var/log/clamav/freshclam.log` for the current status.

```
server@ubuntu:~$ cat /var/log/clamav/freshclam.log
Sat Apr 10 17:51:37 2021 -> daily.cvd database is up to date (version: 26136, sigs: 3969743, f-level: 63, builder: raynman)
Sat Apr 10 17:51:37 2021 -> main.cvd database is up to date (version: 59, sigs: 4564902, f-level: 60, builder: sigmgr)
Sat Apr 10 17:51:37 2021 -> bytecode.cvd database is up to date (version: 333, sigs: 92, f-level: 63, builder: awillia2)
```

Now we'll update our ClamAV daemon configuration to make our server listen to TCP socket 3310.

```
server@ubuntu:~$ sudo nano /etc/clamav/clamd.conf
```

```bash{11}
#Automatically Generated by clamav-daemon postinst
#To reconfigure clamd run #dpkg-reconfigure clamav-daemon
#Please read /usr/share/doc/clamav-daemon/README.Debian.gz for details
LocalSocket /var/run/clamav/clamd.ctl
FixStaleSocket true
LocalSocketGroup clamav
LocalSocketMode 666
# TemporaryDirectory is not set to its default /tmp here to make overriding
# the default with environment variables TMPDIR/TMP/TEMP possible
User clamav
TCPSocket 3310
```

Restart ClamAV to apply the new changes.

```
server@ubuntu:~$ sudo systemctl restart clamav-daemon.service
```

To confirm that ClamAV listen to TCP port 3310 run the command below (requires `net-tools`).

```{4}
server@ubuntu:~$ netstat -lnp | grep -E "(clam|3310)"
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 0.0.0.0:3310            0.0.0.0:*               LISTEN      -
tcp6       0      0 :::3310                 :::*                    LISTEN      -
unix  2      [ ACC ]     STREAM     LISTENING     73674    -                    /var/run/clamav/clamd.ctl
```

Make sure that the firewall settings are in place and that the correct ports are opened for any ClamAV client. See the [Firewall settings](#firewall-settings) section for more information.

* clamdtop

## Ubuntu client

```
client@ubuntu:~$ sudo apt-get install clamav clamav-daemon
```

```
client@ubuntu:~$ sudo systemctl stop clamav-daemon.service
client@ubuntu:~$ sudo systemctl stop clamav-freshclam.service
client@ubuntu:~$ sudo systemctl disable clamav-daemon.service
client@ubuntu:~$ sudo systemctl disable clamav-freshclam.service
```

```
client@ubuntu:~$ sudo nano /etc/clamav/clamd.conf
```

```bash{4,11,12}
#Automatically Generated by clamav-daemon postinst
#To reconfigure clamd run #dpkg-reconfigure clamav-daemon
#Please read /usr/share/doc/clamav-daemon/README.Debian.gz for details
#LocalSocket /var/run/clamav/clamd.ctl
FixStaleSocket true
LocalSocketGroup clamav
LocalSocketMode 666
# TemporaryDirectory is not set to its default /tmp here to make overriding
# the default with environment variables TMPDIR/TMP/TEMP possible
User clamav
TCPSocket 3310
TCPAddr 192.168.0.1
```

## Windows client

## Firewall settings

The firewall being used is UFW (Uncomplicated Firewall). It is set by default to deny incoming traffic, allow outgoing traffic and allow port 22 (OpenSSH). Read more about UFW [here](https://help.ubuntu.com/community/UFW).

::: details UFW Settings
```console
server@ubuntu:~$ sudo ufw default deny incoming
server@ubuntu:~$ sudo ufw default allow outgoing
server@ubuntu:~$ sudo ufw allow 22
server@ubuntu:~$ sudo ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
```
:::

```console
server@ubuntu:~$ sudo ufw allow proto tcp from 192.168.0.2 to any port 3310 comment "ClamAV client"
```

## Scheduled jobs

To keep the ClamAV definition database up-to-date create a scheduled job to run e.g. once everyday (at 00:00).

```
server@ubuntu:~$ sudo -i
root@ubuntu:~$ crontab -e
#
# m h  dom mon dow   command
0 0 * * * freshclam
```

## Troubleshooting

In case you'll need help troubleshooting or support for ClamAV you can sign up for their mailing list at [ClamAV users](https://lists.clamav.net/mailman/listinfo/clamav-users).

## Enterprise solutions <Badge text="non-sponsored" type="default"/>

### Atomic Protector <Badge text="non-affiliate" type="default"/>

Atomic Protector, is an upgrade from Atomic Secured Linux and Atomic Workload Protection products, provides maximum security and compliance for systems in on-premise, cloud and hybrid environments all in a single pane of glass you can run anywhere. Features include compliance and vulnerability management, reporting, intrusion prevention, file integrity monitoring, memory protection and exploit prevention, vulnerability shielding, web application and API protection, application control, and more.

[Atomic Protector](https://atomicorp.com/atomic-protector/)

<social-share />
